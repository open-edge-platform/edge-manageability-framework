# Design Proposal: CVE Tracking for OS Profile and Edge Nodes

Author(s): Daniele Moro

Last updated: 2025-05-08

## Abstract

This proposal describes a mechanism for tracking CVEs (Common Vulnerabilities
and Exposures) for OS Profiles and Edge Nodes in the Edge Infrastructure Manager
(EIM).

## Proposal

Currently, we have no mechanisms to track CVEs related to the OS in Edge
Infrastructure Manager. Ideally, we should have a mechanism to track that a
certain version of the OS is affected by a certain CVE, and that a set of Edge
Nodes are affected too. Also, the user of EIM should be aware of this, and it
should be provided with information about which version of the OS fixed the
given CVE. Users of EIM should be also able to see both forward and backward
list of fixed CVEs. In order to understand the effect on CVEs on updates.

Requirements:
- Report existing CVEs for a given OS Profile version
- Report fixed CVEs on a given OS Profile version
- Report list of CVEs that affect an Instance at runtime
- Do backward and forward fixed CVEs tracking between OSProfile versions

The proposal is to extend both the OS Profile and the Instance resources to
contain information about CVEs.

**OS Profile**:
- `existing_cves`: a JSON field containing CVEs that affect the OS image and
  packages included in that OS Profile version. This is filled from information
  provided by the OS vendor.
- `fixed_cves`: a JSON field containing CVEs that was fixed in the given OS and
  packages included in that OS Profile Version. This is filled from information
  provided by the OS vendor.

**Instance**:
- `existing_cves`: a JSON field containing CVEs that affects the given Instance
  at runtime. The information on this field comes from the Edge Node itself. For
  Immutable OSes this should contain the same values as the `existing_cves` from
  the `current_os` OS Profile.

> Note: for mutable OSes (Ubuntu), the `fixed_cves` will only be informational
> and only valuable for freshly provisioned ENs. To fix further CVEs users can
> update the OS on the ENs, but this will not be tracked explicitly in the
> orchestrator. It can be derived from the list of `existing_cves` in the
> Instance.

Since we support both Immutable OSes, in particular the Edge Microvisor Toolkit
(EMT), and mutable OSes, in particular Ubuntu, we need to design support for CVE
reporting for both OSes. Unfortunately, there is no standard way to publish CVEs
report, so this feature needs to be designed and implemented on a per-OS basis.

### CVE JSON

All CVEs field are modeled as JSON array of objects, where each object contains
the following fields:
- `cve_id`: the CVE ID
- `description`: a short description of the CVE
- `priority`: the priority of the CVE. This can be one of the following values:
  `low`, `medium`, `high`, `critical`. This is classified by the OS vendor. This
  priority could be distinct from the CVSS score.
- `affected_packages`: a list of packages with respective version that are
  affected by the CVE. This is a list of strings, where each string is the name
  of the package. This field is optional, and it can be empty if the CVE affects
  the OS as a whole.

### OS Profile

For the OS profile, for both `existing_cves` and `fixed_cves` we expect support
from the OS Vendor or Provider to provide these information.

For EMT, we expect further information to be published in the Release Service
together with the OS Image itself, and the Manifest:
- A structured file with information of existing CVEs of a given EMT version.
  This file needs to be kept updated by the team maintaining EMT to properly
  publish information of new CVEs affecting a certain EMT version. CVEs notice
  should be published until support for that OSProfile is ended.
- Release Notes for a given EMT version. This file contains the list of fixed
  CVEs on the given version. The Release Notes should be published in a
  structured way, so that it can be parsed and used by the orchestrator. For
example Google Container-Optimized OS published the list of Fixed CVEs for each
versions on every release, for example
https://cloud.google.com/container-optimized-os/docs/release-notes/m121. OS
Resource Manager (OSRM) can populate information about the fixed CVEs when
creating the OSProfile. For existing CVEs instead it must periodically query the
Release Service to get the published file, and fill those information into the
OSProfile.

For Ubuntu, instead, there are multiple ways to get these information:
- [Ubuntu CVE Tracker](https://ubuntu.com/security/cves): this is a web
  interface to navigate CVEs, you can filter by Ubuntu versions, and check the
  status of the CVE.
- [CVE git repo](https://git.launchpad.net/ubuntu-cve-tracker/) Canonical
  maintain a public git repo with structured CVE data
- [Ubuntu OVAL](https://ubuntu.com/security/oval) Ubuntu provides vulnerability
  feeds as structured XML file. This contains all CVEs affecting Ubuntu
  releases, both for packages provided in the Image and on other OS components.
- [osv.dev](https://osv.dev) Ubuntu participates in OSV.dev, that provides a
  standardized CVE APIs. However, this is able to provide CVE for packages, not
  general CVEs affecting a certain Ubuntu release, for example affecting the
  kernel.

The best choice needs to be agreed with a PoCs, this should cover both
information about existing CVEs and fixed CVEs on a given Ubuntu version. The
work of fetching CVEs for Ubuntu should be done by OSRM, that should fill the
fixed CVEs at OSProfile creation time, and periodically update the existing
CVEs.

### Instance
In the case of Instance CVEs, the information regards the software that runs at
runtime in the Edge Node. For EMT, the CVEs of the runtime software are
effectively the same that affect the linked OS Profile. The `existing_cves`
field of the instance can thus be filled automatically with information from the
OS Profile for an initial implementation, while we implement the reporting
mechanism on the Edge Node software. This can be done by Maintenance Manager
(MM), when the Platform Update Agent (PUA) sends its `PlatformUpdateRequest`. At
that moment, MM, could fetch the OSProfile of the given instance, compare
`existing_cves` there and update the `existing_cves` field of the Instance

For Ubuntu, instead, the CVEs that affect an instance at runtime could be
different from the `existing_cves` of the OSProfile, because new packages can be
installed or upgraded at runtime. For this reason, we need a mechanism to report
the CVEs that affect the runtime software. The Ubuntu OVAL data together with
Security Content Automation Protocol (SCAP) compliant tools can be used to scan
and Ubuntu system. Instructions and examples can be found here:
https://ubuntu.com/security/oval. This can be implemented in the Platform Update
Agent, that can reports back to the orchestrator via the Maintenance Manager,
information about existing CVEs on a running Edge Node.

### CVE diffs

[TODO]

## Rationale

An alternative approach, could be to implement the discovery of CVEs for both
OSProfiles and Instances entirely on the orchestrator side for all type of OS.
However, this would embed much more complexity on the orchestrator side, that it
would need to go through each single package available on a target OS and query
upstream services to discover CVEs. Since, EMT has to live also as a standalone
OS, notices for CVEs and Release Notes should be published and openly available.
For Ubuntu, instead, we need to rely on the notices provided by Canonical, via
the ways described above.

## Affected components and Teams

Edge Infrastructure Manager (EIM) - OSRM, MM, PUA
- Inventory: schema change to add the new fields
- API:
    - extend current schemas to add the new fields, fields should be read-only
      from REST API perspective
    - [TODO: custom APIs to show fixed CVEs diff between OSProfiles versions,
      this applies to EMT only]
- MM:
    - Temporary fill `existing_cves` in OSProfile and Instance for Immutable
      OSes
    - Extend Southbound APIs to allow Platform Update Agent to report CVEs
- OSRM:
    - Populate `existing_cves` and `fixed_cves` for Immutable OSes
    - Populate `existing_cves` and `fixed_cves` for Ubuntu OSes (if needed)

Edge Node:
- PUA:
    - Extend the PUA to report CVEs for Ubuntu and Immutable OSes (if needed)

UI/CLI:
- Extend the UI and CLI to show the affected CVEs and fixed CVEs on the OS
  Profiles
- Extend the UI and CLI to show cves of an Instance
- Extend the UI and CLI to diff CVEs between OS Profiles version

## Implementation plan

UI work is still TBD.

Implementation is split into two phases:

### Phase 1 (target EMT 3.1)

Goal: support CVEs tracking and reporting for Immutable OSes

- Schema changes and API
- Support CVEs for Immutable OSes only
    - OSRM to populate `existing_cves` and `fixed_cves` for EMT
    - MM to fill `existing_cves` in OSProfile and Instance for EMT


### Phase 2 (target EMT 3.2)

Goal: support CVEs tracking and reporting for Mutable OS (Ubuntu) and support
diffs

- OSRM to populate `existing_cves` and `fixed_cves` for EMT
- MM extend southbound APIs to allow PUA to report CVEs
- PUT to report runtime CVEs

## Open issues (if applicable)

- Diffs for CVEs? How do we structure fields to do the diff? Should we support
  it as a separate API or we leave it to the UI/presentation layer?
- PoC for Ubuntu CVEs tracking and reporting
- Clarify data migration
