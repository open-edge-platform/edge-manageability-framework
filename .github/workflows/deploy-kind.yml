name: Run Deploy Orchestrator on Kind Every Hour

on:
  schedule:
    - cron: '0 * * * *'  # ⏰ Every 60 minutes (at minute 0 of every hour, UTC)
  push:                  # ✅ Run on every new commit
  workflow_dispatch:     # ✅ Allow manual trigger

jobs:
  deploy-kind:
    runs-on: ubuntu-24.04-16core-64GB

    steps:
      - name: Deploy Orchestrator
        uses: ./.github/actions/deploy-kind
        with:
          orch_version: "main"
          orch_password: ${{ secrets.ORCH_PASSWORD }}
          docker_username: ${{ secrets.DOCKER_USERNAME }}
          docker_password: ${{ secrets.DOCKER_PASSWORD }}
          token: ${{ secrets.PAT_TOKEN }}   # Make sure to store this as a secret
          deployment_type: "all"
      - name: Collect pod logs 
        if: always()
        uses: ./.github/actions/collect_diagnostics
        timeout-minutes: 15

